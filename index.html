<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø§Ø³ØªØ§Ø¯ ÙØ±Ø§ØªÛŒ ØªÙ…Ø¯ÛŒØ¯ Ú©Ù†</title>
  <style>
    :root{
      --bg1:#0b1023;
      --bg2:#1b1240;
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --a1:#ff76c8;
      --a2:#7ab7ff;
      --a3:#8effc1;
      --glow: rgba(255,120,200,.55);
      --glow2: rgba(120,170,255,.45);
      --glass-blur: 14px;
      --shadow-hero: 0 24px 70px rgba(0,0,0,.35);
      --shadow-card: 0 24px 60px rgba(0,0,0,.28);
      --noise-opacity: .18;
      --ring-opacity: .55;
      --ui-bg1: rgba(255,255,255,.10);
      --ui-bg2: rgba(255,255,255,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Vazirmatn", "IRANSans", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 900px at 10% 10%, rgba(122,183,255,.18), transparent 60%),
        radial-gradient(1000px 800px at 90% 20%, rgba(255,118,200,.15), transparent 60%),
        radial-gradient(800px 700px at 50% 90%, rgba(142,255,193,.10), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:var(--noise-opacity);
      pointer-events:none;
    }
    @media (max-width: 640px){
      :root{
        --glass-blur: 6px;
        --shadow-hero: 0 16px 44px rgba(0,0,0,.30);
        --shadow-card: 0 16px 40px rgba(0,0,0,.24);
        --noise-opacity: .10;
        --ring-opacity: .38;
        --ui-bg1: rgba(255,255,255,.12);
        --ui-bg2: rgba(255,255,255,.08);
      }
    }
    @media (prefers-reduced-motion: reduce){
      :root{ --ring-opacity: .18; }
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:40px 18px 70px;
      position:relative;
    }
    .shell{ width:min(1050px, 100%); position:relative; }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 2px 18px;
      opacity:.94;
      flex-wrap:wrap;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border-radius:999px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      user-select:none;
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, white, var(--a1));
      box-shadow: 0 0 18px var(--glow);
    }
    .row{
      display:inline-flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .toggle{
      cursor:pointer;
      border:none;
      color:var(--text);
      font-weight:800;
      padding:10px 14px;
      border-radius:999px;
      background:linear-gradient(180deg, var(--ui-bg1), var(--ui-bg2));
      border:1px solid var(--stroke);
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
      position:relative;
      overflow:hidden;
    }
    .toggle:hover{ box-shadow:0 0 0 1px rgba(255,255,255,.10), 0 10px 30px rgba(0,0,0,.25); filter: brightness(1.05); }
    .toggle:active{ transform:scale(.98); }

    .mini{
      cursor:pointer;
      border:none;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
      color:var(--text);
      font-weight:900;
      transition: transform .12s ease, filter .2s ease;
      position:relative;
      overflow:hidden;
    }
    .mini:active{ transform:scale(.98); }
    .mini:hover{ filter:brightness(1.06); }

    .hero{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius:26px;
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
      box-shadow: var(--shadow-hero);
      position:relative;
      overflow:hidden;
      contain: layout paint;
      transform: translateZ(0);
      will-change: transform;
    }
    .hero::after{
      content:"";
      position:absolute; inset:-2px;
      background: conic-gradient(from 0deg,
        rgba(255,118,200,.0),
        rgba(255,118,200,.55),
        rgba(122,183,255,.55),
        rgba(142,255,193,.4),
        rgba(255,118,200,.55),
        rgba(255,118,200,.0));
      filter: blur(16px);
      opacity: var(--ring-opacity);
      z-index:0;
      animation: spin 10s linear infinite;
      pointer-events:none;
      will-change: transform;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (prefers-reduced-motion: reduce){
      .hero::after{animation:none}
    }

    .heroInner{ position:relative; z-index:1; padding:28px 22px 20px; }

    .mainHeader{
      text-align:center;
      margin: 6px auto 8px;
      line-height:1.65;
      font-weight:950;
      font-size: clamp(22px, 3.2vw, 40px);
      user-select:none;
      text-shadow:
        0 0 18px rgba(255,118,200,.28),
        0 0 24px rgba(122,183,255,.18);
      transform: translateZ(0);
      will-change: transform;
    }
    .mainHeader .handle{
      display:block;
      font-size: clamp(14px, 1.8vw, 18px);
      font-weight:800;
      color:var(--muted);
      margin-top:6px;
    }
    .mainHeader .sub{
      display:block;
      font-size: clamp(14px, 2vw, 20px);
      font-weight:900;
      margin-top:10px;
      color: rgba(255,255,255,.88);
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
      padding:14px 0 10px;
    }
    .pill{
      cursor:pointer;
      border:none;
      padding:11px 14px;
      border-radius:999px;
      color:var(--text);
      background:linear-gradient(180deg, var(--ui-bg1), var(--ui-bg2));
      border:1px solid var(--stroke);
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
      font-weight:900;
      display:inline-flex;
      align-items:center;
      gap:8px;
      position:relative;
      overflow:hidden;
    }
    .pill:hover{ box-shadow: 0 0 0 1px rgba(255,255,255,.10), 0 16px 40px rgba(0,0,0,.28); filter: brightness(1.06); }
    .pill:active{transform:scale(.98)}
    .emoji{filter: drop-shadow(0 6px 14px rgba(0,0,0,.25))}

    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
      margin-top: 14px;
    }
    .card{
      grid-column: span 12;
      padding:16px 16px 14px;
      border-radius:20px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
      position:relative;
      overflow:hidden;
      transition: transform .18s ease, box-shadow .25s ease, filter .2s ease;
      contain: paint;
    }
    .card:hover{ transform: translateY(-2px); box-shadow: var(--shadow-card); filter:brightness(1.03); }
    .card h3{ margin:0 0 6px; font-size:18px; letter-spacing:.2px; }
    .card p{ margin:0; color:var(--muted); line-height:1.75; font-size:14px; white-space:pre-line; }
    .meta{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      color:rgba(255,255,255,.76);
      font-weight:800;
      font-size:13px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    }

    @media (min-width: 860px){
      .card.span6{grid-column: span 6}
      .card.span4{grid-column: span 4}
    }

    .girls{
      position:absolute;
      inset:-40px -30px auto -30px;
      height:340px;
      pointer-events:none;
      opacity:.34;
      transform: translateZ(0);
      will-change: transform;
    }
    .girls svg{width:100%; height:100%}
    .girlGlow{
      filter: drop-shadow(0 0 18px rgba(255,118,200,.25)) drop-shadow(0 0 18px rgba(122,183,255,.18));
    }
    @media (max-width: 640px){
      .girlGlow{ filter: none; }
    }

    #sparkCanvas{
      position:fixed; inset:0;
      z-index:2;
      pointer-events:none;
      opacity:1;
      transition: opacity .2s ease;
    }

    .toast{
      position:fixed;
      right:16px; bottom:16px;
      z-index:5;
      max-width:min(420px, calc(100% - 32px));
      padding:12px 14px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(18,18,40,.55);
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
      opacity:0; transform: translateY(10px);
      transition: opacity .2s ease, transform .2s ease;
      font-weight:900;
      color:rgba(255,255,255,.90);
    }
    .toast.show{opacity:1; transform: translateY(0)}
    .toast small{display:block; margin-top:4px; font-weight:800; color:var(--muted)}

    .ripple{
      position:absolute;
      border-radius:999px;
      transform: translate(-50%,-50%) scale(0);
      opacity:.65;
      pointer-events:none;
      background: radial-gradient(circle, rgba(255,255,255,.75), rgba(255,118,200,.20), transparent 60%);
      animation: ripple .55s ease-out forwards;
    }
    @keyframes ripple{
      to{ transform: translate(-50%,-50%) scale(18); opacity:0; }
    }

    body.low .hero,
    body.low .card,
    body.low .badge,
    body.low .toggle,
    body.low .pill,
    body.low .mini,
    body.low .toast{
      -webkit-backdrop-filter:none !important;
      backdrop-filter:none !important;
    }
  </style>
</head>
<body>
  <canvas id="sparkCanvas"></canvas>

  <div class="wrap">
    <div class="shell">

      <div class="topbar">
        <div class="badge" title="Ø­Ø§Ù„Øª">
          <span class="dot" aria-hidden="true"></span>
          <span id="moodText">Ø­Ø§Ù„Øª: ğŸ˜”</span>
        </div>

        <div class="row">
          <button class="mini" id="pal1" type="button" aria-label="Ù¾Ø§Ù„Øª Û±">ğŸ’—</button>
          <button class="mini" id="pal2" type="button" aria-label="Ù¾Ø§Ù„Øª Û²">ğŸ’™</button>
          <button class="mini" id="pal3" type="button" aria-label="Ù¾Ø§Ù„Øª Û³">ğŸ’š</button>
          <button class="toggle" id="themeBtn" type="button">ØªØºÛŒÛŒØ± ÙØ¶Ø§ âœ¨</button>
        </div>
      </div>

      <section class="hero" id="hero">
        <div class="girls" id="girlsLayer" aria-hidden="true">
          <svg viewBox="0 0 1200 340" class="girlGlow" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="rgba(255,118,200,.70)"/>
                <stop offset="1" stop-color="rgba(122,183,255,.55)"/>
              </linearGradient>
              <linearGradient id="g2" x1="1" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="rgba(142,255,193,.55)"/>
                <stop offset="1" stop-color="rgba(255,118,200,.50)"/>
              </linearGradient>
            </defs>

            <g transform="translate(120 50)">
              <path fill="url(#g1)" opacity=".9"
                d="M160,250 c20,-60 5,-110 -10,-135 c-25,-45 -10,-85 25,-95
                   c30,-10 70,10 75,45 c10,60 -40,70 -45,95 c-5,25 35,35 45,90
                   c-40,20 -90,20 -90,0z"/>
              <circle cx="190" cy="70" r="32" fill="rgba(255,255,255,.12)"/>
              <path fill="rgba(255,255,255,.10)"
                d="M165,92 c10,18 40,18 50,0 c-18,22 -32,26 -50,0z"/>
            </g>

            <g transform="translate(520 25)">
              <path fill="url(#g2)" opacity=".9"
                d="M210,275 c10,-70 -10,-130 -35,-160 c-35,-45 -20,-95 20,-112
                   c48,-20 100,18 102,70 c1,44 -30,56 -46,74 c-16,18 6,34 18,60
                   c18,40 24,58 16,80 c-28,22 -60,26 -75,14z"/>
              <circle cx="225" cy="78" r="34" fill="rgba(255,255,255,.12)"/>
              <path fill="rgba(0,0,0,.10)"
                d="M190,110 c16,10 48,10 68,0 c-18,22 -50,26 -68,0z"/>
            </g>

            <g transform="translate(880 65)">
              <path fill="url(#g1)" opacity=".85"
                d="M170,245 c18,-50 12,-92 -6,-126 c-18,-34 -16,-66 8,-86
                   c28,-24 78,-10 92,28 c10,28 -2,44 -18,60 c-16,16 -6,28 10,54
                   c18,30 26,56 24,80 c-30,18 -76,14 -110,-10z"/>
              <circle cx="210" cy="74" r="30" fill="rgba(255,255,255,.12)"/>
            </g>
          </svg>
        </div>

        <div class="heroInner">
          <h1 class="mainHeader" id="mainHeader">
            Ø§Ø³ØªØ§Ø¯ ÙØ±Ø§ØªÛŒ<br/>
            <span class="handle">@sforati</span>
            <span class="sub">ØªÙ…Ø¯ÛŒØ¯ Ø¯Ø± Ú©Ù…ÛŒÙ† Ø§Ø³Øª Ù…Ú¯Ù‡ Ù†Ù‡ØŸğŸ˜”</span>
          </h1>

          <div class="controls">
            <button class="pill" id="btnMood" type="button"><span class="emoji">ğŸ­</span> ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª</button>
            <button class="pill" id="btnBurst" type="button"><span class="emoji">âœ¨</span> Ø¯Ø±Ø®Ø´Ø´</button>
            <button class="pill" id="btnPulse" type="button"><span class="emoji">ğŸ’«</span> Ø¶Ø±Ø¨Ø§Ù†</button>
            <button class="pill" id="btnFx" type="button"><span class="emoji">âš¡</span> Ø§ÙÚ©Øªâ€ŒÙ‡Ø§: Ø±ÙˆØ´Ù†</button>
            <button class="pill" id="btnCopy" type="button"><span class="emoji">ğŸ“‹</span> Ú©Ù¾ÛŒ Ù…ØªÙ†</button>
          </div>

          <div class="grid">
            <div class="card span6" id="card1">
              <h3>ÛŒÚ© Ø¬Ù…Ù„Ù‡â€ŒÛŒ ØªØ§Ø²Ù‡ Ø¨Ø³Ø§Ø² ğŸ€</h3>
              <p id="quoteText">Ø±ÙˆÛŒ Ú©Ø§Ø±Øª Ø¨Ø²Ù† ØªØ§ Ù…ØªÙ† Ø¹ÙˆØ¶ Ø´ÙˆØ¯.</p>
              <div class="meta">
                <span class="chip" id="tapChip">ØªÙ¾â€ŒÙ‡Ø§: 0</span>
                <span class="chip" id="hintChip">Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø± = Ø¯Ø±Ø®Ø´Ø´ Ø¨ÛŒØ´ØªØ±</span>
              </div>
            </div>

            <div class="card span6" id="card2">
              <h3>Ø´Ø¨ ÛŒÙ„Ø¯Ø§ ğŸ‘€</h3>
              <p>Ø§Ø³ØªØ§Ø¯ ÙØ±Ø§ØªÛŒ
@sforati
ØªØ¹Ù„Ù‚ Ú¯Ø±ÙØªÙ† Ù†Ù…Ø±Ù‡ Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ù‡Ù…Ù‡ Ø¨Ù‡ Ù…Ù†Ø§Ø³Ø¨Øª Ø´Ø¨ ÛŒÙ„Ø¯Ø§ Ø¯Ø± Ú©Ù…ÛŒÙ† Ø§Ø³Øª Ù…Ú¯Ù‡ Ù†Ù‡ØŸğŸ˜”</p>
              <div class="meta">
                <span class="chip" id="palChip">Ù¾Ø§Ù„Øª: ğŸ’—</span>
                <span class="chip" id="modeChip">Ø­Ø§Ù„Øª: ğŸ˜”</span>
              </div>
            </div>

            
          </div>

        </div>
      </section>

    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    const toastEl = document.getElementById("toast");
    let toastTimer = null;
    function toast(msg, sub=""){
      toastEl.innerHTML = `${msg}${sub?`<small>${sub}</small>`:""}`;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toastEl.classList.remove("show"), 2200);
    }

    function ripple(el, ev){
      const r = el.getBoundingClientRect();
      const s = document.createElement("span");
      s.className = "ripple";
      const x = (ev?.clientX ?? (r.left + r.width/2)) - r.left;
      const y = (ev?.clientY ?? (r.top + r.height/2)) - r.top;
      s.style.left = x + "px";
      s.style.top = y + "px";
      s.style.width = Math.max(r.width, r.height) + "px";
      s.style.height = Math.max(r.width, r.height) + "px";
      el.appendChild(s);
      setTimeout(()=>s.remove(), 650);
    }

    const isSmall = matchMedia("(max-width: 640px)").matches;
    const isMobileUA = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent || "");
    const saveData = navigator.connection?.saveData === true;
    const lowMem = (navigator.deviceMemory && navigator.deviceMemory <= 4);
    const lowPower = isSmall || isMobileUA || saveData || lowMem;
    if (lowPower) document.body.classList.add("low");

    const DPR_CAP = lowPower ? 1.25 : 2;
    const TARGET_FPS = lowPower ? 30 : 60;
    const FRAME_MS = 1000 / TARGET_FPS;
    const MAX_SPARKS = lowPower ? 220 : 650;
    const AMBIENT_INTERVAL_MS = lowPower ? 340 : 190;

    const moods = ["ğŸ˜”","ğŸ˜¼","ğŸ˜³","ğŸ˜","ğŸ¥²","ğŸ« "];
    let moodIdx = 0;

    const moodText = document.getElementById("moodText");
    const modeChip = document.getElementById("modeChip");

    function setMood(i){
      moodIdx = (i + moods.length) % moods.length;
      const m = moods[moodIdx];
      moodText.textContent = `Ø­Ø§Ù„Øª: ${m}`;
      modeChip.textContent = `Ø­Ø§Ù„Øª: ${m}`;
      const map = {
        "ğŸ˜”":["rgba(255,120,200,.55)","rgba(120,170,255,.45)","#ff76c8","#7ab7ff","#8effc1"],
        "ğŸ˜¼":["rgba(142,255,193,.55)","rgba(255,118,200,.40)","#8effc1","#ff76c8","#7ab7ff"],
        "ğŸ˜³":["rgba(255,255,255,.40)","rgba(255,118,200,.45)","#ffffff","#ff76c8","#7ab7ff"],
        "ğŸ˜":["rgba(122,183,255,.55)","rgba(142,255,193,.35)","#7ab7ff","#8effc1","#ff76c8"],
        "ğŸ¥²":["rgba(120,170,255,.55)","rgba(255,118,200,.35)","#7ab7ff","#ff76c8","#8effc1"],
        "ğŸ« ":["rgba(255,118,200,.55)","rgba(142,255,193,.35)","#ff76c8","#8effc1","#7ab7ff"]
      };
      const v = map[m] || map["ğŸ˜”"];
      document.documentElement.style.setProperty("--glow", v[0]);
      document.documentElement.style.setProperty("--glow2", v[1]);
      document.documentElement.style.setProperty("--a1", v[2]);
      document.documentElement.style.setProperty("--a2", v[3]);
      document.documentElement.style.setProperty("--a3", v[4]);
    }

    let altTheme = false;
    const themeBtn = document.getElementById("themeBtn");
    themeBtn.addEventListener("click", (e)=>{
      ripple(themeBtn, e);
      altTheme = !altTheme;
      document.documentElement.style.setProperty("--bg1", altTheme ? "#070a14" : "#0b1023");
      document.documentElement.style.setProperty("--bg2", altTheme ? "#201035" : "#1b1240");
      toast(altTheme ? "ÙØ¶Ø§: Ø´Ø¨ ğŸŒ™" : "ÙØ¶Ø§: Ø¨Ù†ÙØ´ ğŸ’œ", "ØªØºÛŒÛŒØ± Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯.");
    });

    const palChip = document.getElementById("palChip");
    function setPalette(name, a1, a2, a3, glow, glow2){
      document.documentElement.style.setProperty("--a1", a1);
      document.documentElement.style.setProperty("--a2", a2);
      document.documentElement.style.setProperty("--a3", a3);
      document.documentElement.style.setProperty("--glow", glow);
      document.documentElement.style.setProperty("--glow2", glow2);
      palChip.textContent = `Ù¾Ø§Ù„Øª: ${name}`;
      toast(`Ù¾Ø§Ù„Øª ${name}`, "Ø±Ù†Ú¯â€ŒÙ‡Ø§ ØªØ§Ø²Ù‡ Ø´Ø¯Ù†Ø¯.");
      addSparks(innerWidth/2, innerHeight/3, lowPower ? 24 : 46, true);
    }

    document.getElementById("pal1").addEventListener("click", (e)=>{ ripple(e.currentTarget, e); setPalette("ğŸ’—", "#ff76c8","#7ab7ff","#8effc1","rgba(255,120,200,.55)","rgba(120,170,255,.45)"); });
    document.getElementById("pal2").addEventListener("click", (e)=>{ ripple(e.currentTarget, e); setPalette("ğŸ’™", "#7ab7ff","#8effc1","#ff76c8","rgba(122,183,255,.55)","rgba(142,255,193,.40)"); });
    document.getElementById("pal3").addEventListener("click", (e)=>{ ripple(e.currentTarget, e); setPalette("ğŸ’š", "#8effc1","#ff76c8","#7ab7ff","rgba(142,255,193,.55)","rgba(255,118,200,.40)"); });

    const canvas = document.getElementById("sparkCanvas");
    const ctx = canvas.getContext("2d", { alpha:true });
    let W=0,H=0,dpr=1;
    const sparks = [];
    const pool = [];
    let fxOn = true;
    let paused = document.hidden;

    function resize(){
      dpr = Math.min(window.devicePixelRatio || 1, DPR_CAP);
      W = canvas.width = Math.floor(window.innerWidth * dpr);
      H = canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
    }
    window.addEventListener("resize", resize, {passive:true});
    resize();

    function allocSpark(){
      return pool.pop() || {x:0,y:0,vx:0,vy:0,life:0,size:0,t:0};
    }

    function addSparks(x,y,count=24, burst=false){
      if (!fxOn) return;
      if (lowPower) count = Math.min(count, burst ? 48 : 12);
      const room = MAX_SPARKS - sparks.length;
      if (room <= 0) return;
      count = Math.min(count, room);

      const sx = x * dpr;
      const sy = y * dpr;

      for(let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const sp = burst ? (2.0 + Math.random()*3.0) : (0.5 + Math.random()*1.7);
        const s = allocSpark();
        s.x = sx; s.y = sy;
        s.vx = Math.cos(a)*sp*dpr;
        s.vy = Math.sin(a)*sp*dpr;
        s.life = 20 + Math.random()*22;
        s.size = 1 + Math.random()*2.0;
        s.t = Math.random();
        sparks.push(s);
      }
    }

    let lastFrameT = 0;
    let ambientT = 0;

    function loop(t){
      requestAnimationFrame(loop);
      if (paused || !fxOn) return;
      if (t - lastFrameT < FRAME_MS) return;
      const dt = t - lastFrameT;
      lastFrameT = t;

      ctx.clearRect(0,0,W,H);

      ambientT += dt;
      if (ambientT >= AMBIENT_INTERVAL_MS){
        ambientT = 0;
        addSparks(Math.random()*innerWidth, -10, 3, false);
      }

      for(let i=sparks.length-1;i>=0;i--){
        const s = sparks[i];
        s.x += s.vx;
        s.y += s.vy;
        s.vx *= 0.96;
        s.vy = s.vy*0.96 + 0.02*dpr;
        s.life -= 1;

        const alpha = Math.max(0, s.life/44);
        ctx.globalAlpha = alpha;

        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size*dpr, 0, Math.PI*2);
        ctx.fillStyle = "rgba(255,255,255,1)";
        ctx.fill();

        if (!lowPower){
          ctx.globalAlpha = alpha*0.28;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.size*3.6*dpr, 0, Math.PI*2);
          ctx.fillStyle = "rgba(255,118,200,1)";
          ctx.fill();
        }

        if(s.life<=0){
          const last = sparks.pop();
          if (i < sparks.length) sparks[i] = last;
          pool.push(s);
        }
      }
      ctx.globalAlpha = 1;
    }
    requestAnimationFrame(loop);

    document.addEventListener("visibilitychange", ()=>{
      paused = document.hidden;
      if (!paused) lastFrameT = 0;
    });

    const hero = document.getElementById("hero");
    const girlsLayer = document.getElementById("girlsLayer");
    let pending = false;
    let px = innerWidth/2, py = innerHeight/2;

    function applyParallax(){
      pending = false;
      const rect = hero.getBoundingClientRect();
      const x = (px - (rect.left + rect.width/2)) / rect.width;
      const y = (py - (rect.top + rect.height/2)) / rect.height;
      const tx = x * (lowPower ? 10 : 18);
      const ty = y * (lowPower ? 6 : 10);
      girlsLayer.style.transform = `translate(${tx}px, ${ty}px)`;
      if (!lowPower){
        const rx = (-y) * 2.0;
        const ry = (x) * 2.0;
        hero.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
      }
    }

    function queueParallax(clientX, clientY){
      px = clientX; py = clientY;
      if (pending) return;
      pending = true;
      requestAnimationFrame(applyParallax);
    }

    window.addEventListener("pointermove", (e)=> queueParallax(e.clientX, e.clientY), {passive:true});
    window.addEventListener("touchmove", (e)=>{
      if(!e.touches?.length) return;
      queueParallax(e.touches[0].clientX, e.touches[0].clientY);
    }, {passive:true});

    if (!lowPower){
      let trailT = 0;
      window.addEventListener("pointermove", (e)=>{
        const now = performance.now();
        if (now - trailT < 55) return;
        trailT = now;
        addSparks(e.clientX, e.clientY, 4, false);
      }, {passive:true});
    }

    let pressTimer = null;
    let pressing = false;

    function startPress(x,y){
      if (!fxOn) return;
      pressing = true;
      const sx = x, sy = y;
      pressTimer = setTimeout(()=>{
        if (!pressing) return;
        addSparks(sx, sy, lowPower ? 26 : 44, true);
        if (navigator.vibrate) navigator.vibrate(18);
      }, lowPower ? 520 : 420);
    }
    function endPress(x,y){
      pressing = false;
      clearTimeout(pressTimer);
      addSparks(x, y, lowPower ? 12 : 18, true);
    }

    window.addEventListener("pointerdown", (e)=> startPress(e.clientX, e.clientY), {passive:true});
    window.addEventListener("pointerup", (e)=> endPress(e.clientX, e.clientY), {passive:true});
    window.addEventListener("pointercancel", ()=>{ pressing=false; clearTimeout(pressTimer); }, {passive:true});

    const btnMood = document.getElementById("btnMood");
    const btnBurst = document.getElementById("btnBurst");
    const btnPulse = document.getElementById("btnPulse");
    const btnFx = document.getElementById("btnFx");
    const btnCopy = document.getElementById("btnCopy");

    function bindRipple(btn){
      btn.addEventListener("click", (e)=> ripple(btn, e));
    }
    [btnMood, btnBurst, btnPulse, btnFx, btnCopy].forEach(bindRipple);
    [themeBtn, document.getElementById("pal1"), document.getElementById("pal2"), document.getElementById("pal3")].forEach(bindRipple);

    btnMood.addEventListener("click", ()=>{
      setMood(moodIdx+1);
      addSparks(innerWidth/2, innerHeight/2, lowPower ? 18 : 34, true);
      toast("Ø­Ø§Ù„Øª Ø¹ÙˆØ¶ Ø´Ø¯ ğŸ­", "ÛŒÙ‡ Ø±Ù†Ú¯ ØªØ§Ø²Ù‡!");
    });

    btnBurst.addEventListener("click", ()=>{
      addSparks(innerWidth/2, innerHeight/3, lowPower ? 48 : 92, true);
      toast("Ø¯Ø±Ø®Ø´Ø´ âœ¨", lowPower ? "Ø³Ø¨Ú© Ùˆ Ø±ÙˆØ§Ù†" : "Ù¾Ø±Ù†ÙˆØ± Ùˆ Ø²Ù†Ø¯Ù‡");
    });

    let pulsing = false;
    let pulseInt = null;
    btnPulse.addEventListener("click", ()=>{
      pulsing = !pulsing;
      if (pulsing){
        toast("Ø¶Ø±Ø¨Ø§Ù† ÙØ¹Ø§Ù„ ğŸ’«", "Ø¨Ø±Ø§ÛŒ Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø²Ù†.");
        pulseInt = setInterval(()=>{
          if (!fxOn || paused) return;
          addSparks(innerWidth/2, innerHeight*0.30, lowPower ? 8 : 14, true);
        }, lowPower ? 520 : 360);
      } else {
        clearInterval(pulseInt);
        toast("Ø¶Ø±Ø¨Ø§Ù† Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯ ğŸ’«");
      }
    });

    btnFx.addEventListener("click", ()=>{
      fxOn = !fxOn;
      canvas.style.opacity = fxOn ? "1" : "0";
      btnFx.innerHTML = fxOn ? '<span class="emoji">âš¡</span> Ø§ÙÚ©Øªâ€ŒÙ‡Ø§: Ø±ÙˆØ´Ù†' : '<span class="emoji">âš¡</span> Ø§ÙÚ©Øªâ€ŒÙ‡Ø§: Ø®Ø§Ù…ÙˆØ´';
      if (!fxOn){
        sparks.length = 0;
        toast("Ø§ÙÚ©Øªâ€ŒÙ‡Ø§ Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯ âš¡", "Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø¨Ú©â€ŒØªØ±");
      } else {
        toast("Ø§ÙÚ©Øªâ€ŒÙ‡Ø§ Ø±ÙˆØ´Ù† Ø´Ø¯ âš¡", "Ø¢Ù…Ø§Ø¯Ù‡â€ŒÛŒ Ø¯Ø±Ø®Ø´Ø´");
        addSparks(innerWidth/2, innerHeight/3, lowPower ? 16 : 28, true);
      }
    });

    btnCopy.addEventListener("click", async ()=>{
      const txt = `Ø§Ø³ØªØ§Ø¯ ÙØ±Ø§ØªÛŒ\n@sforati \nØªÙ…Ø¯ÛŒØ¯ Ø¯Ø± Ú©Ù…ÛŒÙ† Ø§Ø³Øª Ù…Ú¯Ù‡ Ù†Ù‡ØŸğŸ˜”`;
      try{
        await navigator.clipboard.writeText(txt);
        toast("Ú©Ù¾ÛŒ Ø´Ø¯ ğŸ“‹", "Ø±ÙØª ØªÙˆÛŒ Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯.");
      }catch{
        const ta = document.createElement("textarea");
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("Ú©Ù¾ÛŒ Ø´Ø¯ ğŸ“‹");
      }
    });

    const tapChip = document.getElementById("tapChip");
    const quoteText = document.getElementById("quoteText");
    const card1 = document.getElementById("card1");
    let taps = 0;

    const quotes = [
      "Ø§Ù…Ø±ÙˆØ² ØªÙ…Ø¯ÛŒØ¯â€¦ Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ± Ø§Ø² Ù‡Ù…ÛŒØ´Ù‡â€ŒØ³Øª ğŸ˜”",
      "ÛŒÙ‡ Ù†Ù…Ø±Ù‡â€ŒÛŒ Ø§Ø¶Ø§ÙÙ‡ØŒ ÛŒÙ‡ Ù„Ø¨Ø®Ù†Ø¯ Ø§Ø¶Ø§ÙÙ‡ ğŸ™‚",
      "Ø§Ú¯Ø± ØªÙ…Ø¯ÛŒØ¯ Ø´Ø¯â€¦ Ù‚ÙˆÙ„ Ù…ÛŒâ€ŒØ¯ÛŒÙ… Ø¨ÛŒØ´ØªØ± Ø¨Ø®ÙˆÙ†ÛŒÙ… ğŸ˜…",
      "ÛŒÙ„Ø¯Ø§ Ø¨Ù‡Ø§Ù†Ù‡â€ŒØ³Øªâ€¦ Ù…Ù‡Ø±Ø¨ÙˆÙ†ÛŒ Ø§ØµÙ„ÛŒÙ‡ âœ¨",
      "Ù†Ù…Ø±Ù‡â€ŒÛŒ Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø¯Ø± Ú©Ù…ÛŒÙ†Ù‡â€¦ Ø´Ø§ÛŒØ¯ ğŸ˜¶",
      "Ù‡Ø± Ú†ÛŒ Ø¨Ø§Ø´Ù‡ØŒ Ø§Ù…ÛŒØ¯ Ø±ÙˆØ´Ù†Ù‡ ğŸŒ™"
    ];
    function nextQuote(){
      const q = quotes[Math.floor(Math.random()*quotes.length)];
      quoteText.textContent = q;
    }

    card1.addEventListener("click", (e)=>{
      ripple(card1, e);
      taps += 1;
      tapChip.textContent = `ØªÙ¾â€ŒÙ‡Ø§: ${taps}`;
      nextQuote();
      addSparks(innerWidth/2, innerHeight/2, lowPower ? 10 : 18, true);
      card1.animate([
        { transform:"translateY(0) scale(1)" },
        { transform:"translateY(-3px) scale(1.01)" },
        { transform:"translateY(0) scale(1)" }
      ], { duration: 340, easing:"cubic-bezier(.2,.8,.2,1)" });
    }, {passive:true});

    document.querySelectorAll(".card").forEach(card=>{
      if (card === card1) return;
      card.addEventListener("click", (e)=>{
        ripple(card, e);
        const r = card.getBoundingClientRect();
        addSparks(r.left + r.width*0.70, r.top + r.height*0.35, lowPower ? 10 : 16, true);
        card.animate([
          { transform:"translateY(0) scale(1)" },
          { transform:"translateY(-2px) scale(1.008)" },
          { transform:"translateY(0) scale(1)" }
        ], { duration: 320, easing:"cubic-bezier(.2,.8,.2,1)" });
      }, {passive:true});
    });

    setMood(0);
    nextQuote();
    if (lowPower) toast("Ø­Ø§Ù„Øª Ø³Ø¨Ú© ÙØ¹Ø§Ù„ Ø´Ø¯ ğŸ“±", "Ø±ÙˆØ§Ù†â€ŒØªØ± Ø±ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„");
  </script>
</body>
</html>
